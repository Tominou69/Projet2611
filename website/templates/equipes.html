{% extends "base.html" %}

{% block main_content %}
<section>
    <h2>Gestion des équipes</h2>
    <p>
        Sélectionnez entre {{ REQUEST_VARS['morpions_min'] }} et {{ REQUEST_VARS['morpions_max'] }} morpions
        parmi les {{ REQUEST_VARS['morpions_total'] }} modèles disponibles pour créer une nouvelle équipe. 
        <br>
        Ne choissisez pas un meme morpion dans les deux équipes, on est pas sur Fifa Ultimate team ici. 
    </p>
    {% include 'message.html' %}
    <form method="post" class="form-equipe">
        <input type="hidden" name="action" value="create">
        <div class="form-group">
            <label for="nom">Nom de l'équipe</label>
            <input type="text" id="nom" name="nom" value="{{ REQUEST_VARS['form_values'].nom }}" required>
        </div>
        <div class="form-group">
            <label for="couleur">Couleur de l'équipe </label>
            <input type="text" id="couleur" name="couleur" placeholder="#FF6600"
                value="{{ REQUEST_VARS['form_values'].couleur }}">
            <small>ATTENTION : saisis un code hexadécimal (#FF6600) pour différencier les équipes sur les plateaux.</small>
        </div>
        <fieldset class="form-group">
            <legend>Choisir les morpions ({{ REQUEST_VARS['morpions_min'] }} à {{ REQUEST_VARS['morpions_max'] }})</legend>
            <div class="form-morpions">
                {% for morpion in REQUEST_VARS['morpions'] %}
                <label>
                    <input type="checkbox" name="morpions" value="{{ morpion.id }}"
                        {% if morpion.id in REQUEST_VARS['form_values'].morpions %}checked{% endif %}>
                    <span class="morpion-name">{{ morpion.nom }}</span>
                    <img class="morpion-thumb" src="{{ SESSION['DIRECTORY'] }}/{{ morpion.image }}" alt="Illustration de {{ morpion.nom }}">
                    <small>{{ morpion.vie }} PV / {{ morpion.attaque }} ATK / {{ morpion.mana }} Mana / {{ morpion.reussite }} Réussite</small>
                </label>
                {% endfor %}
            </div>
        </fieldset>
        <button type="submit" class="btn-primary">Créer l'équipe</button>
    </form>
</section>

<section>
    <h2>Équipes existantes</h2>
    {% if REQUEST_VARS['equipes'] %}
    <div class="team-grid">
        {% for equipe in REQUEST_VARS['equipes'] %}
        <article class="team-card">
            <header>
                <h3>{{ equipe.nom }}</h3>
                {% if equipe.couleur %}
                <span class="badge-couleur" style="background-color: {{ equipe.couleur | default('#222222') }};">{{ equipe.couleur | default('#222222') }}</span>
                {% else %}
                <span class="badge-couleur">aucune couleur</span>
                {% endif %}
            </header>
           
           

            {% if equipe.morpions %}
            <ol class="team-morpions">
                {% for morpion in equipe.morpions %}
                <li>
                    #{{ morpion.ordre }} — {{ morpion.nom }}
                </li>
                {% endfor %}
            </ol>
            {% else %}
            <p class="alert-warning">Aucun morpion associé.</p>
            {% endif %}
            <form method="post" class="form-inline">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="equipe_id" value="{{ equipe.id }}">
                <button type="submit" class="btn-danger" onclick="return confirm('Supprimer définitivement cette équipe ?');">Supprimer</button>
            </form>
        </article>
        {% endfor %}
    </div>
    {% else %}
        <p class="alert-warning">Aucune équipe n'a encore été créée.</p>
    {% endif %}
</section>
{% endblock %}

